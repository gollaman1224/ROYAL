<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë©¤ë²„ ë¦¬ìŠ¤íŠ¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #161b22 80%, #0a0f14 100%);
      min-height: 100vh;
      margin: 0;
      font-family: 'Orbitron','Malgun Gothic',sans-serif;
      color: #eaf8ff;
    }
    .container {
      max-width: 1050px;
      margin: 44px auto 0 auto;
      background: linear-gradient(145deg, #222930 85%, #181c20 100%);
      border-radius: 24px;
      box-shadow: 0 8px 42px #11f3ff77, 0 0 0 2px #1af6ff3f;
      padding: 36px 28px 36px 28px;
      position: relative;
      overflow: hidden;
    }
    .nav-links {
      margin-bottom: 22px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px 16px;
    }
    .nav-link {
      display: inline-block;
      font-weight: 700;
      color: #1af6ff;
      text-decoration: none;
      padding: 9px 22px;
      border: 2px solid #1af6ff;
      border-radius: 13px;
      transition: background 0.23s, color 0.23s;
      background: rgba(17,243,255,0.07);
      font-size: 1.06rem;
      letter-spacing: 0.2px;
      box-shadow: 0 0 10px #1af6ff22;
    }
    .nav-link:hover {
      background: #1af6ff;
      color: #181c20;
      text-shadow: 0 0 7px #fff;
    }
    .search-bar {
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .search-bar input[type="text"] {
      padding: 10px 14px;
      font-size: 1rem;
      border-radius: 11px;
      border: 1.3px solid #1af6ff44;
      background: #212a31;
      color: #1af6ff;
      outline: none;
      font-family: inherit;
    }
    .search-bar button {
      padding: 10px 24px;
      font-size: 1rem;
      background: linear-gradient(95deg, #1af6ff 60%, #5a90ff 100%);
      color: #181c20;
      border: none;
      border-radius: 11px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 12px #11f3ff22;
      transition: box-shadow 0.14s, filter 0.14s;
    }
    .search-bar button:hover {
      box-shadow: 0 0 0 2px #1af6ff, 0 2px 16px #11f3ff66;
      filter: brightness(1.11);
    }
    .count-info {
      margin-bottom: 13px;
      color: #99cce8;
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    .group-title {
      margin-top: 32px;
      font-size: 1.13rem;
      color: #1af6ff;
      font-weight: 900;
      letter-spacing: 0.7px;
      text-shadow: 0 0 8px #1af6ff44;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    table {
      width: 100%;
      background: rgba(24,28,32,0.94);
      border-radius: 18px;
      border-collapse: collapse;
      margin-bottom: 27px;
      font-size: 1rem;
      box-shadow: 0 0 14px #1af6ff33;
    }
    th, td {
      padding: 9px 7px;
      text-align: center;
      border-bottom: 1px solid #1af6ff18;
      font-size: 1rem;
    }
    th {
      background: #1af6ff10;
      color: #1af6ff;
      font-weight: 700;
      letter-spacing: 0.6px;
    }
    td {
      color: #eaf8ff;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .btn-edit, .btn-delete {
      padding: 5px 13px;
      font-size: 0.97rem;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: box-shadow 0.14s, filter 0.13s;
    }
    .btn-edit {
      background: #2fe1b8;
      color: #172b24;
      box-shadow: 0 2px 8px #2fe1b844;
    }
    .btn-edit:hover {
      background: #1af6ff;
      filter: brightness(1.12);
    }
    .btn-delete {
      background: #ff5b7f;
      color: #fff;
      margin-left: 5px;
      box-shadow: 0 2px 8px #ff5b7f44;
    }
    .btn-delete:hover {
      background: #ea3275;
      filter: brightness(1.09);
    }
    @media (max-width: 900px) {
      .container { padding: 8vw 1vw 10vw 1vw; }
      table, th, td { font-size: 0.93rem; }
      .nav-link { font-size: 0.96rem; padding: 7px 8vw; }
      .group-title { margin-top: 18px; }
    }
    @media (max-width: 600px) {
      .container { padding: 3vw 0 9vw 0; }
      table, th, td { font-size: 0.87rem; }
      .nav-link { padding: 8px 5vw; }
    }
    .toggle-field {
      cursor: pointer;
      font-size: 1.15rem;
      user-select: none;
      transition: color 0.17s;
    }
    .toggle-field.active {
      color: #1af6ff;
      text-shadow: 0 0 8px #1af6ff77;
    }
    .toggle-field.inactive {
      color: #556e8b;
      opacity: 0.58;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav-links">
      <a href="{{ url_for('servers') }}" class="nav-link">ì„œë²„ ëª©ë¡</a>
      <a href="{{ url_for('party') }}" class="nav-link">íŒŒí‹° ë§¤ì¹­</a>
      <a href="{{ url_for('distribute') }}" class="nav-link">ë¶„ë°° ë°°ì •</a>
      <a href="{{ url_for('add_member_form') }}" class="nav-link">+ ìƒˆ ë©¤ë²„ ì¶”ê°€</a>
      <a href="{{ url_for('dashboard') }}" class="nav-link">ëŒ€ì‹œë³´ë“œ</a>
    </div>
    <form class="search-bar" method="GET" action="{{ url_for('index') }}">
      <input type="text" name="q" placeholder="ë‹‰ë„¤ì„, ì§ì—…, ì‹ í™”, ìŠ¤í‚¬, ë‚˜ì¹¨ë°˜ ê²€ìƒ‰" value="{{ query }}">
      <button type="submit">ê²€ìƒ‰</button>
      {% if query %}
      <a href="{{ url_for('index') }}" style="color:#8ae3ff;font-size:1.03rem;margin-left:10px;">ì´ˆê¸°í™”</a>
      {% endif %}
    </form>
    <div class="count-info">
      ì „ì²´ ë©¤ë²„ ìˆ˜: {{ total_count }}ëª…
    </div>
    {% for job, members in grouped_members.items() %}
      <div class="group-title">
        {% if job == "ë±…ê°€ë“œ" %}ğŸ›¡ï¸
        {% elif job == "ë²„ì„œì»¤" %}ğŸª“
        {% elif job == "ë‚˜ì´íŠ¸ë ˆì¸ì ¸" %}ğŸ¹
        {% elif job == "ì–´ìŒ”ì‹ " %}âš”ï¸
        {% elif job == "ë””ë°”ì¸ìºìŠ¤í„°" %}ğŸ’–
        {% elif job == "ì—˜ë¦¬ë©˜íƒˆ" %}ğŸ”¥
        {% elif job == "ë°ìŠ¤ë¸Œë§ì–´" %}â˜ ï¸
        {% elif job == "ë””ìŠ¤íŠ¸ë¡œì´ì–´" %}ğŸ¯
        {% endif %}
        {{ job }} ({{ members | length }}ëª…)
      </div>
      <table>
        <thead>
          <tr>
            <th>ë‹‰ë„¤ì„</th>
            <th>ì‹ í™”ê°œìˆ˜</th>
            <th>ë‚˜ì¹¨ë°˜</th>
            <th>ì „ì„¤ìŠ¤í‚¬</th>
            <th>ì„œë²„</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody>
          {% for member in members %}
          <tr>
            <td>
              {{ member['ë‹‰ë„¤ì„'] }}
              {% if member['ì§ì—…'] == "ë±…ê°€ë“œ" %}ğŸ›¡ï¸
              {% elif member['ì§ì—…'] == "ë²„ì„œì»¤" %}ğŸª“
              {% elif member['ì§ì—…'] == "ë‚˜ì´íŠ¸ë ˆì¸ì ¸" %}ğŸ¹
              {% elif member['ì§ì—…'] == "ì–´ìŒ”ì‹ " %}âš”ï¸
              {% elif member['ì§ì—…'] == "ë””ë°”ì¸ìºìŠ¤í„°" %}ğŸ’–
              {% elif member['ì§ì—…'] == "ì—˜ë¦¬ë©˜íƒˆ" %}ğŸ”¥
              {% elif member['ì§ì—…'] == "ë°ìŠ¤ë¸Œë§ì–´" %}â˜ ï¸
              {% elif member['ì§ì—…'] == "ë””ìŠ¤íŠ¸ë¡œì´ì–´" %}ğŸ¯
              {% endif %}
            </td>
            <td>{{ member['ì‹ í™”ê°œìˆ˜'] }}</td>
            <td class="toggle-field {% if member['ë‚˜ì¹¨ë°˜'] == 'O' %}active{% else %}inactive{% endif %}"
                data-field="ë‚˜ì¹¨ë°˜" data-nick="{{ member['ë‹‰ë„¤ì„'] }}">
              {% if member['ë‚˜ì¹¨ë°˜'] == 'O' %}âœ”ï¸{% else %}âœ˜{% endif %}
            </td>
            <td class="toggle-field {% if member.get('ì „ì„¤ìŠ¤í‚¬', 'ì—†ìŒ') == 'ìˆìŒ' %}active{% else %}inactive{% endif %}"
                data-field="ì „ì„¤ìŠ¤í‚¬" data-nick="{{ member['ë‹‰ë„¤ì„'] }}">
              {% if member.get('ì „ì„¤ìŠ¤í‚¬', 'ì—†ìŒ') == 'ìˆìŒ' %}âœ”ï¸{% else %}âœ˜{% endif %}
            </td>
            <td>{{ member['ì„œë²„'] }}</td>
            <td>
              <a class="btn-edit" href="{{ url_for('edit_member', nick=member['ë‹‰ë„¤ì„']) }}">ìˆ˜ì •</a>
              <a class="btn-delete" href="{{ url_for('delete_member', nick=member['ë‹‰ë„¤ì„']) }}" onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?');">ì‚­ì œ</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}
  </div>
<script>
  // ê²€ìƒ‰ ìë™ í¬ì»¤ìŠ¤ + ì»¤ì„œ ë ì´ë™
  window.onload = function() {
    const searchInput = document.querySelector('.search-bar input[name="q"]');
    if (searchInput) {
      searchInput.focus();
      const val = searchInput.value;
      searchInput.value = '';
      searchInput.value = val;
    }
  };

  // ë‚˜ì¹¨ë°˜/ì „ì„¤ìŠ¤í‚¬ í´ë¦­ í† ê¸€ (AJAX)
  document.querySelectorAll('td.toggle-field').forEach(cell => {
    cell.addEventListener('click', () => {
      const nick = cell.dataset.nick;
      const field = cell.dataset.field;
      const isActive = cell.classList.contains("active");
      let newVal = "";
      if(field === "ë‚˜ì¹¨ë°˜") {
        newVal = isActive ? "" : "O";
      } else if(field === "ì „ì„¤ìŠ¤í‚¬") {
        newVal = isActive ? "ì—†ìŒ" : "ìˆìŒ";
      }
      fetch('/toggle_field', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({nick: nick, field: field, value: newVal})
      })
      .then(res => res.json())
      .then(data => {
        if(data.success){
          cell.textContent = (newVal === "" || newVal === "ì—†ìŒ") ? "âœ˜" : "âœ”ï¸";
          cell.classList.toggle("active");
          cell.classList.toggle("inactive");
        } else {
          alert("ë³€ê²½ ì‹¤íŒ¨: " + (data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
        }
      })
      .catch(() => alert("ì„œë²„ì™€ í†µì‹  ì‹¤íŒ¨"));
    });
  });
</script>
</body>
</html>
